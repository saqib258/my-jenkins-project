pipeline {
    // 1. TOP LEVEL: 'pipeline'
    agent any // General agent for the overall pipeline

    stages {
        // 2. STAGE LEVEL: Define a stage
        stage('Checkout Code') {
            steps {
                checkout scm
            }
        }

        stage('Build Docker Image') {
            // 3. AGENT LEVEL: Define the docker agent here, as a direct child of the stage
            agent {
                docker {
                    image 'docker:dind'
                    args '--privileged'
                }
            }
            // 4. STEPS LEVEL: The 'steps' block MUST follow the 'agent' block, 
            //    and be a direct child of the 'stage' block.
            steps { 
                sh 'docker build -t hello-jenkins .'
            }
        }

        // Add more stages here...
    }
}
